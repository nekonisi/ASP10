Day10-1
===

# 概要

Global.asaxでエラー処理を記述しよう！

## このレッスンの狙い

- `Global.asax`は、アプリケーション内で発生したイベントを処理するためのファイルである。
- `Global.asax`を利用することで、アクセスログやエラー情報、独自の認証処理、アプリケーション/セッション共通で利用可能なオブジェクトの定義を行うことが可能になる。

## `Global.asax`とは？

- Global.asaxはグローバルアプリケーションファイルとも呼ばれ、アプリケーションで発生する各種イベント(アプリケーションイベント)を処理したり、アプリケーション/セッション共通で利用可能なオブジェクトの宣言を行ったりするために使用する。
  - 共通の処理を記述するためのファイル。
- ファイル名は*Global.asax*固定で、変更することができない。
- `Web.config`とは異なり、必ずアプリケーションルートの直下に配置しなければならない。

### Global.asaxで利用可能なアプリケーションイベント

- Global.asaxで利用可能なイベント

#### 分類: 条件

イベントハンドラ|概要
----------------|----
`Application_Start`|アプリケーションが初回起動した一回のみ発生
`Session_Start`|ユーザセッションが初回起動した1回のみ発生<br>※ セッション変数などを初期化するためなどに使用
`Session_End`|ユーザセッションがクローズしたタイミングで発生<br>※ セッション変数にプールされた情報をDBなどに最終的に保存するために使用する。
`Application_End`|アプリケーションが破棄されたタイミングで発生<br>※ アプリケーション変数にプールされた情報をDBなどに最終的に保存するために使用する。
`Application_Error`|アプリケーション内で処理されない例外(エラー)が発生した場合に発生<br>※エラーログの記録や管理者への通知、エラーページの生成などのために使用

#### 分類: リクエスト

イベントハンドラ|概要
----------------|----
`Application_BeginRequest`|HTTPハンドラがリクエスト処理を開始する前に発生
`Application_AuthenticateRequest`|認証の準備ができたタイミングで発生<br>※ 独自の認証機能を構築したい場合に利用
`Application_PostAuthenticateRequest`|ユーザ認証が完了したタイミングで発生
`Application_AuthorizeRequest`|ユーザが認定されるタイミングで発生
`Application_PostAuthorizeRequest`|ユーザの認定が完了したタイミングで発生
`Application_ResolveRequestCache`|リクエストを、*キャッシュ処理*するタイミングで発生
`Application_PostResolveRequestCache`|ASP.NETがキャッシュからの処理を許可した場合に発生
`Application_PostResolveRequestHandler`|要求が適切なイベントハンドラにマップされたタイミングで発生
`Application_AcquireRequestState`|リクエストに関連づいた状態(セッション状態など)を取得するタイミングで発生<br>※ 独自のセッション管理を行いたい場合に利用
`Application_PostAcquireRequestState`|リクエストに関連づいた状態を取得し終えたタイミングで発生
`Application_PreRequestHandlerExecute`|HTTPハンドラがページの実行を開始する直前に発生
`Application_PostRequestHandlerExecute`|HTTPハンドラがページの実行を開始する直後に発生
`Application_ReleaseRequestState`|すべての実行を完了したタイミングで発生
`Application_PostReleaseRequestState`|リクエストに関連づいた状態をストアに保存し終えたタイミングで発生。<br>※ 本イベントのタイミングで、出力のフォルダ処理なども行われる。

## まとめ

[TOPへ](./index.md)  
